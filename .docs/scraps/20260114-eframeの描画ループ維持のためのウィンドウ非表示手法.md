# eframe の描画ループ維持のためのウィンドウ非表示手法

## 概要

eframe (egui) を使用したアプリケーションにおいて、Windows OS の `ShowWindow(hwnd, SW_HIDE)` を使用してウィンドウを非表示にすると描画ループ（`update` 関数）が停止してしまう問題を回避するため、ウィンドウを画面外に移動させることで擬似的に非表示にする手法を検討した。

## 問題点

- `ShowWindow(hwnd, SW_HIDE)` を実行すると、OS レベルでウィンドウが非アクティブ・非表示扱いになる。
- これにより `eframe` の内部描画ループが停止し、バックグラウンドでのロジック実行やイベント処理に支障が出る。

## 解決策

- ウィンドウを完全に非表示にするのではなく、座標を画面外に飛ばすことでユーザーから見えない状態にする。
- OS からは「表示中（ただし画面外）」と認識されるため、`eframe` の `update` ループが継続される。

## 具体的な実装案

### ウィンドウを表示する処理

- `SetWindowPos` を使用してウィンドウを画面内の有効な座標に移動する。
- `ShowWindow(hwnd, SW_SHOW)` を呼び出し、`SetForegroundWindow` でフォーカスを移す。

```rust
fn show_window(&mut self, hwnd: HWND) {
    unsafe {
        SetWindowPos(
            hwnd,
            0,
            100,
            100,
            0,
            0,
            SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED,
        );
        ShowWindow(hwnd, SW_SHOW);
        let ok = SetForegroundWindow(hwnd);
        if ok == 0 {
            warn!("SetForegroundWindow が失敗しました: hwnd={:?}", hwnd);
        }
    }
    self.apply_no_taskbar_style(hwnd);
    let _ = self.ui.tx.send(endpoint::UiCommand::ForcusInput);
}
```

### ウィンドウを非表示にする処理

- `ShowWindow(hwnd, SW_HIDE)` は使用せず、`SetWindowPos` で座標を `-10000, -10000` 等の画面外に設定する。

```rust
fn hide_window(&mut self, hwnd: HWND) {
    unsafe {
        SetWindowPos(
            hwnd,
            0,
            -10000,
            -10000,
            0,
            0,
            SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED,
        );
    }
}
```

## 注意点

- eframe がウィンドウ位置を管理している場合、この外部からの座標操作と競合する可能性がある。
- ユーザー体験向上のため、表示位置は固定値ではなく前回の表示位置を保存・復元することが推奨される。
