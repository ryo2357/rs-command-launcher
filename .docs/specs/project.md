# プロジェクト仕様

## プロジェクト概要

- Windows 向けのコマンドランチャー（常駐してホットキーで呼び出す想定）
- 設定ファイルに定義されたコマンドを実行する
- env ファイルに定義された環境変数を、コマンド実行時に子プロセスへ渡す

## 対象 OS

- Windows を主対象とする

## プロジェクト構造

- src/main.rs
  - エントリーポイント
  - 設定読み込みと簡易 CLI を提供する
- src/paths.rs
  - 設定ファイルの探索パスを提供する
- src/config.rs
  - setting.yaml と env.yaml のデシリアライズと読み込み
- src/runner.rs
  - 設定に基づくプロセス起動
- src/tray.rs
  - 常駐とタスクトレイ（tao + tray-icon）

## エントリーポイント構成

- `main` はログ初期化と `app()` の実行、失敗時の終了コード制御を担当する
- 実処理は `app()` に集約し `anyhow::Result<()>` を返す
- `app()` が失敗した場合、`main` はプロセス終了コード 1 で終了する

## ログ

- ログ出力は `log` クレートの `info!` と `error!` を使用する
- ログの初期化は `main` 関数で `init_logger()` を呼び出して行う
- ログレベル
  - Debug ビルドは Info 以上を出力する
  - Release ビルドはログ出力を行わない
- 簡易 CLI の出力
  - `paths` は設定ファイルと env ファイルのパスをログ出力する
  - `run-first` と `run` は起動したコマンド名をログ出力する
  - それ以外の呼び出しは設定読み込み完了とコマンド件数をログ出力する

## 設定ファイル

- 設定ディレクトリ
  - `~/.config/command-launcher/`
- setting.yaml
  - コマンド一覧を定義する
- env.yaml
  - 環境変数（キーと値）を定義する

## データ構造

- Settings
  - commands: CommandSpec の配列
- CommandSpec
  - name: コマンド識別子
  - program: 実行ファイル
  - args: 引数配列（省略可）
  - cwd: 作業ディレクトリ（省略可）
- EnvVars
  - 環境変数のマップ（キーと値）

## 現時点の実装範囲

- 実装済み
  - 設定パス解決
  - YAML 設定読み込み
  - 環境変数の読み込み
  - 設定に基づくコマンド起動
- 未実装
  - 常駐（実装中）
  - タスクトレイ（実装中）
  - グローバルホットキー
  - フルスクリーン判定とホットキー無効化
  - UI

## 常駐とタスクトレイの現状

- 目的
  - 引数なし起動時に常駐モードへ移行し、タスクトレイから終了できる
- 実装状況
  - `src/tray.rs` に tao と tray-icon を用いた実装を追加している
  - `src/main.rs` の引数なし起動で `tray::run_tray()` を呼び出す
- 未達事項
  - ユーザー環境でタスクトレイが動作しないため、手順 3 の最小要件（右クリックメニューから終了）が満たせていない
  - 現状は実装途中扱いとする
